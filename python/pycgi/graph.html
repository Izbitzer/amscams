<head> 
   <script src="/pycgi/dist/js/amscam.min.js"></script>

</head>
<body style="margin:0;padding:0;background:transparent">
<div id="graph" style="width:100%; margin: 0 auto" ></div>
</body>

<script>

// HEx to RGBA 
function hexToRgb(hex) {
    var bigint = parseInt(hex, 16);
    var r = (bigint >> 16) & 255;
    var g = (bigint >> 8) & 255;
    var b = bigint & 255;
    return r + "," + g + "," + b + ",1";
}
 

// GET ALL QUERY PARAMETERS 
function getQueryParams(qs) {
    qs = qs.split("+").join(" ");
    var params = {},
        tokens,
        re = /[?&]?([^=]+)=([^&]*)/g;

    while (tokens = re.exec(qs)) {
        params[decodeURIComponent(tokens[1])]  = decodeURIComponent(tokens[2]);
    }

    return params;
}

var all_variables = getQueryParams(document.location.search);
var all_data;


// Do we have a json_file
if(typeof all_variables['json_file']!='undefined') {
   // We parse the JSON File
   $.ajax({
      dataType: "json",
      url:  all_variables['json_file'],
      success: function(data) {
         all_data = data;
        
         // We get the corresponding graph layout definition
         if(typeof all_variables['graph_config']!='undefined') {
            $.getScript(all_variables['graph_config'], function( d, textStatus, jqxhr ) {
               trace1.x = all_data.x1_vals;
               trace1.y = all_data.y1_vals;
               trace1.mode = all_data.linetype1;
               trace1.name = all_data.title1;
               layout.title.text =  all_data.title;

               // We had the color scale for X
               trace1.marker.color  =  all_colors;

               // If it's the same ratio on the SERIE 1
               if(all_data.s_ratio1) {
                  layout.yaxis.scaleanchor = "x";
                  layout.yaxis.scaleratio = 1;  
               }

               // If we reverse the Y1 axis
               if(all_data.y1_reverse=='1') {
                  layout.yaxis.autorange = 'reversed';
               }
  

               var data = [trace1];
               Plotly.newPlot("graph", data, layout, {responsive: true});


               if (all_data.x2_vals != false && all_data.y2_vals != false) {

                  var trace2 = {
                     x: all_data.x2_vals,
                     y: all_data.y2_vals,
                     mode: 'lines',
                     type: 'scatter', 
                     name: all_data.title2,
                     yaxis: "x2",
                     line: {
                        color: 'rgba(213,42,224,.5)' 
                     }
                  };


                  // We add the 2nd "trace"
                  Plotly.addTraces("graph",trace2 );
               } 

            });

         
         }

      }
   });
}


</script>
